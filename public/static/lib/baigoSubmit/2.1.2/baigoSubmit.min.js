/*
v2.1.2 jQuery baigoSubmit plugin 表单提交插件
(c) 2013 baigo studio - http://www.baigo.net/
License: http://www.opensource.org/licenses/mit-license.php
*/
;(function($){$.fn.baigoSubmit=function(options){'use strict';if(this.length<1){return this;}
var obj_form=$(this);obj_form.submit(function(evt){evt.preventDefault();});var opts_default={ajax_url:'',timeout:30000,class_content:{submitting:'text-info',err:'text-danger',success:'text-success'},class_icon:{submitting:'spinner-grow spinner-grow-sm',err:'fas fa-times-circle',success:'fas fa-check-circle'},msg_text:{submitting:'Submitting ...',err:'Error'},selector:{submit_btn:'[type="submit"]',empty_input:':password',jump_link:'.bg-jump'},modal:{selector:{modal:'.bg-submit-modal',content:'.bg-content',icon:'.bg-icon',msg:'.bg-msg',close:'.bg-close',ok:'.bg-ok'},btn_text:{close:'Close',ok:'OK'},tpl:'<div class="modal fade bg-submit-modal">'+'<div class="modal-dialog modal-dialog-centered">'+'<div class="modal-content">'+'<div class="modal-body d-flex justify-content-between align-items-end">'+'<p class="lead bg-content">'+'<span class="bg-icon mr-2"></span>'+'<span class="bg-msg"></span>'+'</p>'+'<p class="bg-jump">'+'</p>'+'</div>'+'<div class="modal-footer">'+'<button type="button" class="btn btn-outline-secondary btn-sm bg-close" data-dismiss="modal">Close</button>'+'<a href="#" class="btn btn-primary btn-sm bg-ok">OK</a>'+'</div>'+'</div>'+'</div>'+'</div>',delay:5000},jump:{url:'',text:'',icon:'spinner-grow spinner-grow-sm',attach_key:'',separator:'',equal:'',delay:3000}};var opts=$.extend(true,opts_default,options);var modal_selector=opts.modal.selector.modal;if($(modal_selector).length<1){$('body').append(opts.modal.tpl);}
$(modal_selector+' '+opts.modal.selector.content).addClass(opts.class_content.submitting);$(modal_selector+' '+opts.modal.selector.icon).addClass(opts.class_icon.submitting);$(modal_selector+' '+opts.modal.selector.msg).html(opts.msg_text.submitting);$(modal_selector+' '+opts.modal.selector.close).text(opts.modal.btn_text.close);$(modal_selector+' '+opts.modal.selector.ok).text(opts.modal.btn_text.ok);$(modal_selector+' '+opts.modal.selector.ok).hide();var process={output:function(_action,_rcode,_msg,_attach_value){switch(_action){case'pre':$(modal_selector+' '+opts.modal.selector.content).removeClass(opts.class_content.submitting+' '+opts.class_content.err+' '+opts.class_content.success);$(modal_selector+' '+opts.modal.selector.content).addClass(opts.class_content.submitting);$(modal_selector+' '+opts.modal.selector.icon).removeClass(opts.class_icon.submitting+' '+opts.class_icon.err+' '+opts.class_icon.success);$(modal_selector+' '+opts.modal.selector.icon).addClass(opts.class_icon.submitting);$(modal_selector+' '+opts.modal.selector.msg).html(opts.msg_text.submitting);$(modal_selector).modal('show');obj_form.find(opts.selector.submit_btn).attr('disabled',true);break;case'err':$(modal_selector+' '+opts.modal.selector.content).removeClass(opts.class_content.submitting+' '+opts.class_content.err+' '+opts.class_content.success);$(modal_selector+' '+opts.modal.selector.content).addClass(opts.class_content.err);$(modal_selector+' '+opts.modal.selector.icon).removeClass(opts.class_icon.submitting+' '+opts.class_icon.err+' '+opts.class_icon.success);$(modal_selector+' '+opts.modal.selector.icon).addClass(opts.class_icon.err);$(modal_selector+' '+opts.modal.selector.msg).html(opts.msg_text.err+'! '+_msg);break;case'success':var _class,_icon,_str_rcode,_rcode_status;var _msg_html='<span>';if(typeof _rcode=='undefined'||_rcode===null){_rcode='x';}
_rcode_status=_rcode.substr(0,1);if(_rcode_status=='y'){_class=opts.class_content.success;_icon=opts.class_icon.success;_str_rcode='';}else{_class=opts.class_content.err;_icon=opts.class_icon.err;_str_rcode=' '+_rcode;}
if(typeof _msg!='undefined'){_msg_html=_msg+_str_rcode;}
_msg_html+='</span>';if(_rcode_status=='y'&&opts.jump.url.length>0&&opts.jump.text.length>0){var _jump_url=opts.jump.url;var _str_separator='';var _str_equal='';if(typeof opts.jump.attach_key!='undefined'&&opts.jump.attach_key.length>0&&typeof _attach_value!='undefined'){if(typeof opts.jump.separator!='undefined'&&opts.jump.separator.length>0){_str_separator=opts.jump.separator;}else{if(_jump_url.indexOf('?')){_str_separator='&';}else{_str_separator='?';}}
if(typeof opts.jump.equal!='undefined'&&opts.jump.equal.length>0){_str_equal=opts.jump.equal;}else{_str_equal='=';}
_jump_url+=_str_separator+opts.jump.attach_key+_str_equal+_attach_value;}
$(modal_selector+' '+opts.modal.selector.ok).attr('href',_jump_url);$(modal_selector+' '+opts.modal.selector.ok).show();var _msg_jump='<a href="'+_jump_url+'">'+opts.jump.text+'</a>';$(opts.selector.jump_link).html(_msg_jump);_icon=opts.jump.icon;}
$(modal_selector+' '+opts.modal.selector.content).removeClass(opts.class_content.submitting+' '+opts.class_content.err+' '+opts.class_content.success);$(modal_selector+' '+opts.modal.selector.content).addClass(_class);$(modal_selector+' '+opts.modal.selector.icon).removeClass(opts.class_icon.submitting+' '+opts.class_icon.err+' '+opts.class_icon.success);$(modal_selector+' '+opts.modal.selector.icon).addClass(_icon);$(modal_selector+' '+opts.modal.selector.msg).html(_msg_html);if(_str_rcode.length<1){obj_form.find(opts.selector.empty_input).val('');if(typeof opts.jump.url!='undefined'&&opts.jump.url.length>0){setTimeout(function(){window.location.href=_jump_url;},opts.jump.delay);}}
break;default:$(modal_selector).modal('hide');obj_form.find(opts.selector.submit_btn).removeAttr('disabled');break;}},submitFunc:function(callback){var _str_separator;if(typeof opts.ajax_url=='undefined'||opts.ajax_url==''){opts.ajax_url=obj_form.attr('action');}
if(opts.ajax_url.indexOf('?')>0){_str_separator='&';}else{_str_separator='?';}
$.ajax({url:opts.ajax_url+_str_separator+new Date().getTime()+'at'+Math.random(),type:'post',dataType:'json',data:$(obj_form).serialize(),timeout:opts.timeout,beforeSend:function(){process.output('pre');},error:function(result){process.output('err','',result.status+' '+result.statusText);setTimeout(function(){process.output();},opts.modal.delay);},success:function(result){var result_attach_value;if(typeof opts.jump.attach_key!='undefined'&&typeof result[opts.jump.attach_key]!='undefined'){result_attach_value=result[opts.jump.attach_key];}
if(typeof result.msg=='undefined'&&result.err_message!='undefined'){result.msg=result.err_message;}
if(callback&&callback instanceof Function){callback(result);}
process.output('success',result.rcode,result.msg,result_attach_value);setTimeout(function(){process.output();},opts.modal.delay);}});}};var el={formSubmit:function(url,callback){if(typeof url!='undefined'&&url!==false){opts.ajax_url=url;}
process.submitFunc(function(result){if(callback&&callback instanceof Function){callback(result);}});},ajaxUrl:function(url){if(typeof url!='undefined'){opts.ajax_url=url;}}};return el;};})(jQuery);